<% content_for :scripts do %>
  <script>
    var geolocation = new qq.maps.Geolocation("O2KBZ-EILW5-NOJIH-QWO7L-VLF25-QFFDV", "community_disaster_prevent");
    // 获取当前定位
    geolocation.getLocation(showPosition, showErr, options);
    var positionNum = 0;
    var options = {timeout: 80000};

    function showPosition(r) {
      console.log(r);
      // 重定向
      window.location.href = "../weather_essential?lon="+r.lng+"&lat="+r.lat;
    };

    function showErr() {
      document.getElementById("map_container").innerHTML = "定位失败！";
    };
  </script>
<% end %>
