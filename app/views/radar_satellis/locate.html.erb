<% content_for :scripts do %>
  <script type="text/javascript" src="http://3gimg.qq.com/lightmap/components/geolocation/geolocation.min.js"></script>
  <script>
    // 解决雷达卫星页面返回后，重新载入的问题
    if(sessionStorage.getItem('now_url') === "/radar_satellis") {
      sessionStorage.removeItem('now_url');
      var userAgent = navigator.userAgent;
      if (userAgent.indexOf("Firefox") != -1 || userAgent.indexOf("Chrome") !=-1) {
         window.location.href="about:blank";
      } else {
         window.opener = null;
         window.open("", "_self");
         window.close();
      };
    } else {
      var geolocation = new qq.maps.Geolocation("O2KBZ-EILW5-NOJIH-QWO7L-VLF25-QFFDV", "community_disaster_prevent");
      // 获取当前定位
      geolocation.getLocation(showPosition, showErr, options);
      var positionNum = 0;
      var options = {timeout: 80000};
    }
    function showPosition(r) {
      console.log(r);
      // 重定向
      window.location.href = "../radar_satellis?lon="+r.lng+"&lat="+r.lat;
    };

    function showErr() {
      document.getElementById("map_container").innerHTML = "定位失败！";
    };
  </script>
<% end %>