<% content_for :scripts %>
  <script>
    var geolocation = new qq.maps.Geolocation("O2KBZ-EILW5-NOJIH-QWO7L-VLF25-QFFDV", "community_disaster_prevent");
    // 获取当前定位
    geolocation.getLocation(showPosition, showErr, options);
    var positionNum = 0;
    var options = {timeout: 80000};

    function showPosition(r) {
      console.log(r);
      // 重定向
      window.location.href = "http://cs.tallty.com/radar_satellis?lon="+r.lng+"&lat="+r.lat;
    };

    function showErr() {
      document.getElementById("map_container").innerHTML = "定位失败！";
    };
  </script>
<% end %>

<!-- <script>
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition,showError);
    // lat=position.coords.latitude;
    // lon=position.coords.longitude;
  }
  else {
    location.href = "../radar_satellis?lon=121.19&lat=31.5";
  }

  function showPosition(position) {
    lat=position.coords.latitude;
    lon=position.coords.longitude;
    location.href = "../radar_satellis?lon="+lon+"&lat="+lat;
  }

  function showError(error) {
    location.href = "../radar_satellis?lon=121.19&lat=31.5";
    // switch(error.code) {
    //   case error.PERMISSION_DENIED:
    //     alert("User denied the request for Geolocation.");
    //     break;
    //   case error.POSITION_UNAVAILABLE:
    //     alert("Location information is unavailable.");
    //     break;
    //   case error.TIMEOUT:
    //     alert("The request to get user location timed out.");
    //     break;
    //   case error.UNKNOWN_ERROR:
    //     alert("An unknown error occurred.");
    //     break;
    // }
  }
</script> -->
